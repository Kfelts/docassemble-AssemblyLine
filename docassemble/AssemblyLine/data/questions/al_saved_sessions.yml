---
modules:
  - .sessions
---
id: save answer snapshot
# Save a copy
decoration: save
question: |
  Save an answer set
subquestion: |
  You can load this answer set in a new interview later.
    
  #### Your progress
  You visited ${ all_variables(include_internal=True).get('_internal',{}).get('steps',1) }
  screens in "${ all_variables(special='titles').get('full') }" so far.
fields:
  - Name your answer set: al_sessions_snapshot_label
    default: |      
      % if defined('users[0].name.first'):
      ${ comma_and_list(users.complete_elements()) }
      % if defined('other_parties[0].name.first'):
      v. ${ comma_and_list(other_parties.complete_elements()) }
      % endif
      % else:
      ${ all_variables(special='titles').get('full') }
      % if all_variables(special='titles').get('sub'):
      : ${ all_variables(special='titles').get('sub') }
      % endif
      % endif
    help: |
      Give this answer set a name you can remember later
continue button label: |
  :save: Save

---
decoration: folder-open
question: |
  Load answers
subquestion: |
  ${ interview_list_html() }
continue button field: al_load_saved_session_screen
continue button label: Resume
---
event: al_load_saved_session
code: |
  # Using this code block that then loads a screen is critical to get this to work
  # without taking people back to the screen after they load the answers
  # set_save_status('ignore')
  al_load_saved_session_screen  
---
event: al_sessions_fast_forward_session
code: |
  # set_save_status('ignore')
  load_interview_answers(action_argument("i"), action_argument("session"), new_session=False)
  force_ask('al_sessions_load_status')
---
code: |
  if task_not_yet_performed("save session"):
      try:
        new_session_id = save_interview_answers(
              metadata = { "title": al_sessions_snapshot_label }
            )
        log(f"Saved interview {al_sessions_snapshot_label} with id {new_session_id}")
      except:
        pass
      mark_task_as_performed("save session")
  al_sessions_save_session_snapshot = True
---
continue button field: al_sessions_save_status
comment: |
  #TODO There's no error handling yet so this might be a lie
question: |
  Your answer set was successfully saved
subquestion: |
  Tap "next" to keep answering any unanswered questions and finish the interview.
---
continue button field: al_sessions_load_status
comment: |
  #TODO There's no error handling yet so this might be a lie
question: |
  Your answer set was successfully loaded
subquestion: |
  Tap "next" to keep answering any unanswered questions and finish the interview.